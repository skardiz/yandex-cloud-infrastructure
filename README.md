# Инфраструктура для Kubernetes кластера в Yandex.Cloud на Terraform

Этот репозиторий содержит код на Terraform для автоматического развертывания полноценного, готового к работе управляемого кластера Kubernetes (Managed Kubernetes) в облаке Yandex.Cloud. Проект демонстрирует подход "Инфраструктура как Код" (Infrastructure as Code, IaC).

Цель проекта — создать воспроизводимую, безопасную и масштабируемую среду для запуска контейнеризированных приложений.

## Создаваемые ресурсы

При выполнении `terraform apply` будут созданы следующие ресурсы в Yandex.Cloud:

*   **`yandex_vpc_network`**: Изолированная виртуальная сеть (VPC) для всей инфраструктуры.
*   **`yandex_vpc_subnet`**: Подсеть в зоне `ru-central1-a` внутри созданной VPC.
*   **`yandex_vpc_security_group`**: Группа безопасности (облачный файрвол) с набором правил для контроля трафика:
    *   Разрешение входящего трафика для API Kubernetes (порты 443, 9443).
    *   Разрешение доступа по SSH (порт 22).
    *   Разрешение доступа к NodePort сервисам.
    *   Правила для корректной работы облачного балансировщика и внутрикластерного взаимодействия.
    *   Разрешение всего исходящего трафика.
*   **`yandex_kubernetes_cluster`**: Мастер-нода управляемого кластера Kubernetes.
*   **`yandex_kubernetes_node_group`**: Группа рабочих узлов (1 нода), на которых будут запускаться приложения.

## Технологии

*   **Terraform**: Для декларативного описания и управления инфраструктурой.
*   **Yandex.Cloud**: В качестве облачного провайдера.
*   **Kubernetes**: В качестве системы оркестрации контейнеров.

## Предварительные требования

Перед началом работы убедитесь, что у вас установлены:

1.  **Terraform** (`v1.0.0` или выше).
2.  **Yandex.Cloud CLI (`yc`)**: Установлен и настроен профиль по умолчанию.

Также в корневой директории проекта должны находиться два файла, которые **не должны** попадать в Git (они уже добавлены в `.gitignore`):

*   `key.json`: Файл с ключом сервисного аккаунта Yandex.Cloud, который имеет права на создание всех необходимых ресурсов.
*   `ansible_vps.pub`: Ваш публичный SSH-ключ. Путь к нему (`~/.ssh/ansible_vps.pub`) указан в `main.tf`. При необходимости измените его на свой.

## Использование

1.  **Инициализация проекта:**
    В корневой директории выполните команду для загрузки необходимых плагинов Terraform.
    ```
    terraform init
    ```

2.  **Создание инфраструктуры:**
    Примените конфигурацию для создания всех облачных ресурсов. Terraform покажет план и запросит подтверждение.
    ```
    terraform apply
    ```
    Введите `yes` для подтверждения. Процесс создания кластера может занять 5-10 минут.

3.  **Уничтожение инфраструктуры:**
    Чтобы удалить все созданные ресурсы и избежать лишних трат, выполните команду:
    ```
    terraform destroy
    ```

## Безопасность

**ВАЖНО:** Этот репозиторий использует `.gitignore` для исключения файлов с чувствительными данными:
*   `key.json` (секретный ключ сервисного аккаунта)
*   `*.tfstate` (файл состояния Terraform, который может содержать секреты)

Никогда не публикуйте эти файлы в публичных репозиториях.
